(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();const c="/api/tmdb",y=[{id:"vidsrc",name:"VidSrc",embed:"https://vidsrc.to/embed/{type}/{id}"},{id:"vidsrcme",name:"VidSrc.me",embed:"https://vidsrc.me/embed/{type}/{id}"},{id:"vidplay",name:"VidPlay",embed:"https://playtube.ws/embed/{type}/{id}"},{id:"streamtape",name:"StreamTape",embed:"https://streamtape.com/e/{id}"},{id:"vidguard",name:"VidGuard",embed:"https://vidguard.site/embed/{type}/{id}"},{id:"superembed",name:"SuperEmbed",embed:"https://superembed.link/{type}/{id}"}];let v=localStorage.getItem("zrn_server")||"vidsrc",k="movie",h=null;const b=document.getElementById("trendingMovies"),K=document.getElementById("popularKdramas"),V=document.getElementById("topAnime"),z=document.getElementById("newReleases"),G=document.getElementById("heroBg"),w=document.getElementById("heroTitle"),U=document.getElementById("heroDesc"),W=document.getElementById("heroPlay"),J=document.getElementById("heroWatchlist"),u=document.getElementById("detailModal"),Y=document.getElementById("detailTitle"),Q=document.getElementById("detailOverview"),X=document.getElementById("detailPoster"),Z=document.getElementById("detailBadge"),ee=document.getElementById("detailMeta"),m=document.getElementById("playerModal"),i=document.getElementById("playerFrame"),te=document.getElementById("modalTitle"),I=document.getElementById("modalFullscreen"),f=document.getElementById("searchInput"),l=document.getElementById("searchResults"),ne=document.getElementById("searchBtn"),R=document.querySelectorAll(".nav-tab"),ae=document.querySelectorAll(".mobile-nav-btn"),se=document.querySelectorAll(".page");let S=null;document.addEventListener("DOMContentLoaded",()=>{de(),ue(),me(),fe(),ie(),le(),oe(),ve(),ge(),Ee(),be(),re()});function oe(){const e=document.getElementById("logo");e&&(e.style.cursor="pointer",e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})}))}function re(){const e=document.querySelector(".source-row");if(!e)return;const t=e.querySelector(".source-label");e.innerHTML="",t&&e.appendChild(t),y.forEach(n=>{const s=document.createElement("button");s.className=`source-btn ${n.id===v?"active":""}`,s.textContent=n.name,s.dataset.server=n.id,s.addEventListener("click",()=>ce(n.id)),e.appendChild(s)})}function ce(e){v=e,localStorage.setItem("zrn_server",e),document.querySelectorAll(".source-btn").forEach(t=>{t.classList.toggle("active",t.dataset.server===e)}),h&&C(h,k)}function C(e,t){let s=(y.find(a=>a.id===v)||y[0]).embed.replace("{id}",e).replace("{type}",t);i.src=s}function le(){I&&I.addEventListener("click",()=>{var t;const e=document.querySelector(".player-wrap");e&&(document.fullscreenElement?document.exitFullscreen():e.requestFullscreen?e.requestFullscreen():i.requestFullscreen?i.requestFullscreen():(t=i.webkitRequestFullscreen)==null||t.call(i))})}function ie(){const e=document.getElementById("navbar");window.addEventListener("scroll",()=>{window.scrollY>50?e.classList.add("scrolled"):e.classList.remove("scrolled")})}function de(){R.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;_(t)})}),ae.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.tab;_(t)})})}function _(e){R.forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),se.forEach(t=>{t.classList.toggle("active",t.id===`page-${e}`)}),e==="movies"?H():e==="kdrama"?N():e==="anime"?O():e==="watchlist"&&we()}function ue(){f.addEventListener("input",e=>{clearTimeout(S);const t=e.target.value.trim();if(t.length<2){l.style.display="none";return}S=setTimeout(()=>B(t),300)}),ne.addEventListener("click",()=>{const e=f.value.trim();e.length>=2&&B(e)}),document.addEventListener("click",e=>{e.target.closest(".search-wrap")||(l.style.display="none")})}function me(){const e=document.getElementById("mobileSearchBtn"),t=document.getElementById("mobileSearch"),n=document.getElementById("mobileSearchClose"),s=document.getElementById("mobileSearchInput"),a=document.getElementById("mobileSearchResults");if(!e||!t)return;e.addEventListener("click",()=>{t.classList.add("active"),s.focus()}),n&&n.addEventListener("click",()=>{t.classList.remove("active"),s.value="",a.innerHTML=""}),t.addEventListener("click",r=>{r.target===t&&(t.classList.remove("active"),s.value="",a.innerHTML="")});let o=null;s.addEventListener("input",r=>{clearTimeout(o);const d=r.target.value.trim();if(d.length<2){a.innerHTML="";return}o=setTimeout(()=>pe(d),300)})}async function pe(e){document.getElementById("mobileSearchResults");try{const[t,n]=await Promise.all([fetch(`${c}/search/movie?query=${encodeURIComponent(e)}`),fetch(`${c}/search/tv?query=${encodeURIComponent(e)}`)]),s=await t.json(),a=await n.json(),o=[...(s.results||[]).map(r=>({...r,media_type:"movie"})),...(a.results||[]).map(r=>({...r,media_type:"tv"}))].sort((r,d)=>(d.popularity||0)-(r.popularity||0));ye(o)}catch(t){console.error("Mobile search failed:",t)}}function ye(e){const t=document.getElementById("mobileSearchResults");if(e.length===0){t.innerHTML='<div class="search-empty" style="text-align: center; padding: 40px; color: var(--text-muted);">No results found</div>';return}t.innerHTML=e.slice(0,10).map(n=>{const s=n.title||n.name,a=n.release_date||n.first_air_date||"",o=a?a.split("-")[0]:"",r=n.media_type==="movie"?"Movie":"TV Show";return`
      <div class="search-item" data-id="${n.id}" data-type="${n.media_type}">
        <img class="search-thumb" src="${n.poster_path?"https://image.tmdb.org/t/p/w92"+n.poster_path:""}" alt="${s}">
        <div class="search-info">
          <div class="search-name">${s}</div>
          <div class="search-meta">${o} • ${r}</div>
        </div>
      </div>
    `}).join(""),t.querySelectorAll(".search-item").forEach(n=>{n.addEventListener("click",()=>{const s=n.dataset.id,a=n.dataset.type;x(s,a),document.getElementById("mobileSearch").classList.remove("active"),document.getElementById("mobileSearchInput").value="",t.innerHTML=""})})}async function B(e){try{const[t,n]=await Promise.all([fetch(`${c}/search/movie?query=${encodeURIComponent(e)}`),fetch(`${c}/search/tv?query=${encodeURIComponent(e)}`)]),s=await t.json(),a=await n.json(),o=[...(s.results||[]).map(r=>({...r,media_type:"movie"})),...(a.results||[]).map(r=>({...r,media_type:"tv"}))].sort((r,d)=>(d.popularity||0)-(r.popularity||0));he(o)}catch(t){console.error("Search failed:",t)}}function he(e){if(e.length===0){l.innerHTML='<div class="search-empty">No results found</div>',l.style.display="block";return}l.innerHTML=e.slice(0,8).map(t=>{const n=t.title||t.name,s=t.release_date||t.first_air_date||"",a=s?s.split("-")[0]:"",o=t.media_type==="movie"?"Movie":"TV Show";return`
      <div class="search-item" data-id="${t.id}" data-type="${t.media_type}">
        <img class="search-thumb" src="${t.poster_path?"https://image.tmdb.org/t/p/w92"+t.poster_path:""}" alt="${n}">
        <div class="search-info">
          <div class="search-name">${n}</div>
          <div class="search-meta">${a} • ${o}</div>
        </div>
      </div>
    `}).join(""),l.style.display="block",l.querySelectorAll(".search-item").forEach(t=>{t.addEventListener("click",()=>{const n=t.dataset.id,s=t.dataset.type;x(n,s),l.style.display="none",f.value="";const a=document.getElementById("mobileSearch");a&&a.classList.remove("active")})})}function fe(){document.getElementById("detailClose").onclick=()=>{u.style.display="none"},document.getElementById("modalClose").onclick=()=>{i.src="",m.style.display="none"},u.addEventListener("click",e=>{e.target===u&&(u.style.display="none")}),m.addEventListener("click",e=>{e.target===m&&(i.src="",m.style.display="none")})}async function ve(){try{const t=await(await fetch(`${c}/trending/movie/week`)).json();if(!t.results||t.results.length===0)return;const n=t.results[0];G.style.backgroundImage=n.backdrop_path?`url(https://image.tmdb.org/t/p/original${n.backdrop_path})`:"",w.textContent=n.title,U.textContent=n.overview,W.onclick=()=>F(n.id,n.title),J.onclick=()=>A(n),b.innerHTML="",t.results.forEach(s=>{if(!s.poster_path)return;const a=q(s);b.appendChild(a)})}catch(e){console.error("Failed to load trending:",e),w.textContent="Failed to load"}}async function ge(){try{const t=await(await fetch(`${c}/discover/tv?with_origin_states=KR&sort_by=popularity.desc`)).json();g(K,t.results||[])}catch(e){console.error("Failed to load K-Dramas:",e)}}async function Ee(){try{const t=await(await fetch(`${c}/discover/tv?with_genres=16&sort_by=popularity.desc`)).json();g(V,t.results||[])}catch(e){console.error("Failed to load Anime:",e)}}async function be(){try{const t=await(await fetch(`${c}/movie/now_playing?language=en-US`)).json();g(z,t.results||[])}catch(e){console.error("Failed to load New Releases:",e)}}function g(e,t){e.innerHTML="",t.slice(0,12).forEach(n=>{if(!n.poster_path)return;const s=q(n);e.appendChild(s)})}function q(e){const t=document.createElement("div");return t.className="card",t.innerHTML=`
    <img class="card-thumb" src="https://image.tmdb.org/t/p/w300${e.poster_path}" alt="${e.title||e.name}" loading="lazy">
    <div class="card-overlay">
      <span class="card-title">${e.title||e.name}</span>
    </div>
  `,t.onclick=()=>E(e),t}function E(e){Y.textContent=e.title||e.name,Q.textContent=e.overview||"No description available.",e.poster_path&&(X.src=`https://image.tmdb.org/t/p/w500${e.poster_path}`),e.vote_average&&(Z.textContent=`★ ${e.vote_average.toFixed(1)}`);const t=e.release_date?e.release_date.split("-")[0]:e.first_air_date?e.first_air_date.split("-")[0]:"",n=e.media_type||(e.title?"movie":"tv");ee.textContent=`${t} • ${n==="movie"?"Movie":"TV Show"}`,u.style.display="flex";const s=e.media_type||(e.title?"movie":"tv");document.getElementById("detailPlay").onclick=()=>{F(e.id,e.title||e.name,s)},document.getElementById("detailWatchlist").onclick=()=>{A(e)}}function F(e,t,n="movie"){u.style.display="none",h=e,k=n,te.textContent=t,C(e,n),m.style.display="flex"}async function x(e,t){try{const n=t==="movie"?`movie/${e}`:`tv/${e}`,a=await(await fetch(`${c}/${n}`)).json();E(a)}catch(n){console.error("Failed to fetch detail:",n)}}function A(e){let t=JSON.parse(localStorage.getItem("zrn_watchlist")||"[]");if(t.find(s=>s.id===e.id&&s.media_type===(e.title?"movie":"tv"))){L("Already in watchlist!");return}t.push({id:e.id,title:e.title||e.name,poster_path:e.poster_path,media_type:e.title?"movie":"tv"}),localStorage.setItem("zrn_watchlist",JSON.stringify(t)),L("Added to watchlist!")}function L(e){const t=document.getElementById("toast");t.textContent=e,t.classList.add("show"),setTimeout(()=>t.classList.remove("show"),3e3)}let P=1;async function H(e=1){try{const n=await(await fetch(`${c}/discover/movie?sort_by=popularity.desc&page=${e}`)).json();p("movieGrid",n.results||[],e>1),P=e}catch(t){console.error("Failed to load movies:",t)}}var $;($=document.getElementById("loadMoreMovies"))==null||$.addEventListener("click",()=>H(P+1));let j=1;async function N(e=1){try{const n=await(await fetch(`${c}/discover/tv?with_origin_country=KR&sort_by=popularity.desc&page=${e}`)).json();p("kdramaGrid",n.results||[],e>1),j=e}catch(t){console.error("Failed to load K-Dramas:",t)}}var T;(T=document.getElementById("loadMoreKdrama"))==null||T.addEventListener("click",()=>N(j+1));let D=1;async function O(e=1){try{const n=await(await fetch(`${c}/discover/tv?with_genres=16&sort_by=popularity.desc&page=${e}`)).json();p("animeGrid",n.results||[],e>1),D=e}catch(t){console.error("Failed to load Anime:",t)}}var M;(M=document.getElementById("loadMoreAnime"))==null||M.addEventListener("click",()=>O(D+1));function we(){const e=JSON.parse(localStorage.getItem("zrn_watchlist")||"[]"),t=document.getElementById("watchlistGrid"),n=document.getElementById("watchlistEmpty");if(e.length===0){t.innerHTML="",n.style.display="block";return}n.style.display="none",p("watchlistGrid",e,!1)}function p(e,t,n=!1){const s=document.getElementById(e);n||(s.innerHTML=""),t.forEach(a=>{if(!a.poster_path)return;const o=document.createElement("div");o.className="card",o.innerHTML=`
      <img class="card-thumb" src="https://image.tmdb.org/t/p/w300${a.poster_path}" alt="${a.title||a.name}" loading="lazy">
      <div class="card-overlay">
        <span class="card-title">${a.title||a.name}</span>
      </div>
    `,o.onclick=()=>E(a),s.appendChild(o)})}
